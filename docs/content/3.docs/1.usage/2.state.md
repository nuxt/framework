# State

Nuxt provides `useState` to create a globally shared state.

## `useState`

Within your pages, components and plugins you can use `useState`. It can be used to create your own store implementation.

You can think of it as an SSR-friendly ref in that its value will be hydrated (preserved) after server-side rendering. It is shared across all components.

### Usage

```js
useState<T>(key: string, init?: (()=>T)): Ref<T>
```

* **key**: a unique key ensuring that data fetching can be properly de-duplicated across requests
* **init**: a function that provides initial value for the state when it's not initiated

There is also a helper function `stateKey` that simply returns a string key with an association to the type of the state.

### Example

In this example, we use a server-only plugin to find about request locale.

```ts [plugins/locale.server.ts]
import { defineNuxtPlugin, useState } from '#app'

export default defineNuxtPlugin((nuxt) => {
  const locale = useState(
    'locale',
    () => nuxt.ssrContext.req.headers['accept-language']?.split(',')[0]
  )
})
```

```ts [utils/state-keys.ts]
import { stateKey } from '#app'

export const localeKey = stateKey<string>('locale')
```

```vue
<script setup>
import { localeKey } from '~/utils/state-keys'

// this will be typed `string | undefined`
const locale = useState(localeKey)
// you can also return the state by simply passing the string,
// though unless you declare the state type globally (see below),
// it will not be typed.
const locale = useState('locale')
</script>

<template>
  Current locale: {{ locale }}
</template>
```

### Typing states

In addition to using a `stateKey` to infer the type of `useState`, as above, you can also declare the type of the states throughout in your application:

```ts [index.d.ts]
declare module '#app' {
  interface NuxtStates {
    locale: string
  }
}

export {}
```
